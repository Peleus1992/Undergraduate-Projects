<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">

<title>Hardware Abstraction Layer: nvm.c File Reference</title>

<LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">

</head><body>

<table border="0" cellspacing="0" cellpadding="0"  width=100%>

<tr>

<td><img src="ST_Logo.gif"></td>

<td> <div class="qindex">

<a class="qindex" href="index.html">Home</a>&nbsp;

 | &nbsp;<a class="qindex" href="modules.html">Modules</a>&nbsp;

 | &nbsp;<a class="qindex" href="annotated.html">Data Structures</a>&nbsp;

 | &nbsp;<a class="qindex" href="files.html">File List</a>&nbsp;

 | &nbsp;<a class="qindex" href="globals.html">Index</a></div>

</td>

</table>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>nvm.c File Reference</h1>
<p>Cortex-M3 Non-Volatile Memory data storage system.  
<a href="#_details">More...</a></p>
<code>#include &quot;<a class="el" href="error_8h_source.html">error.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="flash_8h_source.html">hal/micro/cortexm3/flash.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="nvm_8h_source.html">hal/micro/cortexm3/nvm.h</a>&quot;</code><br/>

<p><a href="nvm_8c_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="nvm_8c.html#ad6931f5fde9deafb2614299031cf7660">ERASE_PAGE</a>(page)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="nvm_8c.html#af8b1fac3d3a93cfece7fd073936ad0f4">WRITE_DATA</a>(destPage, srcPage, offset, length)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="nvm_8c.html#a310ac45c60bdd17bb8dbd7981512eda9">WRITE_MGMT_16BITS</a>(address, data)</td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">NO_STRIPPING __no_init&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="nvm_8c.html#af47df57a01ae5d80ddaff1b8b448215d">VAR_AT_SEGMENT</a> (const <a class="el" href="group__iar.html#gae712ac7a6479b38bdbb3286e80b72049">int8u</a> nvmStorageLeft[NVM_DATA_SIZE_B], __NVM__)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__iar.html#gae712ac7a6479b38bdbb3286e80b72049">int8u</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__nvm.html#ga94b214413e5f6af2473a8dafc63bf350">halCommonReadFromNvm</a> (void *data, <a class="el" href="group__iar.html#ga2ba8e0357fdc7b7a450e6893ed81e8e3">int32u</a> offset, <a class="el" href="group__iar.html#ga409a5c4bea6981c30b308684efa33f6f">int16u</a> length)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Copy the NVM data from flash into the provided RAM location. It is illegal for the offset to be greater than NVM_DATA_SIZE_B.  <a href="group__nvm.html#ga94b214413e5f6af2473a8dafc63bf350"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__iar.html#ga409a5c4bea6981c30b308684efa33f6f">int16u</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__nvm.html#ga75ec83fdb3880797604bbc124fc6738c">halCommonGetAddressFromNvm</a> (<a class="el" href="group__iar.html#ga2ba8e0357fdc7b7a450e6893ed81e8e3">int32u</a> offset)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Return the address of the token in NVM.  <a href="group__nvm.html#ga75ec83fdb3880797604bbc124fc6738c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__iar.html#gae712ac7a6479b38bdbb3286e80b72049">int8u</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__nvm.html#ga2efce64dd793cbbcb56c362b5489a379">halCommonWriteToNvm</a> (const void *data, <a class="el" href="group__iar.html#ga2ba8e0357fdc7b7a450e6893ed81e8e3">int32u</a> offset, <a class="el" href="group__iar.html#ga409a5c4bea6981c30b308684efa33f6f">int16u</a> length)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Write the NVM data from the provided location RAM into flash. It is illegal for the offset to be greater than NVM_DATA_SIZE_B.  <a href="group__nvm.html#ga2efce64dd793cbbcb56c362b5489a379"></a><br/></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>Cortex-M3 Non-Volatile Memory data storage system. </p>
<p>This file implements the NVM data storage system. Refer to <a class="el" href="nvm_8h.html" title="Cortex-M3 Non-Volatile Memory data storage system. See Nvm for documentation.">nvm.h</a> for full documentation of how the NVM data storage system works, is configured, and is accessed. </p>

<p>Definition in file <a class="el" href="nvm_8c_source.html">nvm.c</a>.</p>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="ad6931f5fde9deafb2614299031cf7660"></a><!-- doxytag: member="nvm.c::ERASE_PAGE" ref="ad6931f5fde9deafb2614299031cf7660" args="(page)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ERASE_PAGE</td>
          <td>(</td>
          <td class="paramtype">page&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Value:</b><div class="fragment"><pre class="fragment"><span class="keywordflow">do</span> {                            \
    status = erasePage(page);     \
    <span class="keywordflow">if</span>(status != ST_SUCCESS) { \
      <span class="keywordflow">return</span> status;              \
    }                             \
  } <span class="keywordflow">while</span>(0)
</pre></div>
<p>Definition at line <a class="el" href="nvm_8c_source.html#l00211">211</a> of file <a class="el" href="nvm_8c_source.html">nvm.c</a>.</p>

</div>
</div>
<a class="anchor" id="af8b1fac3d3a93cfece7fd073936ad0f4"></a><!-- doxytag: member="nvm.c::WRITE_DATA" ref="af8b1fac3d3a93cfece7fd073936ad0f4" args="(destPage, srcPage, offset, length)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define WRITE_DATA</td>
          <td>(</td>
          <td class="paramtype">destPage, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">srcPage, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">offset, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">length&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Value:</b><div class="fragment"><pre class="fragment"><span class="keywordflow">do</span> {                                                                    \
    <span class="comment">/*Copy all data below the new data from the srcPage to the destPage*/</span> \
    status = <a class="code" href="group__flash.html#ga5eae5ae946c993e4f710e0e9b17f18a7" title="Writes a block of words to flash. A page is erased to 0xFFFF at every address. Only...">halInternalFlashWrite</a>(destPage+<a class="code" href="group__nvm.html#gac8953aab91c6b245cd9c0f03fe88d4bf" title="Define the number of bytes that comprise the NVM management bytes. All data must...">NVM_MGMT_SIZE_B</a>,              \
                                   (<a class="code" href="group__iar.html#ga409a5c4bea6981c30b308684efa33f6f">int16u</a> *)(srcPage+<a class="code" href="group__nvm.html#gac8953aab91c6b245cd9c0f03fe88d4bf" title="Define the number of bytes that comprise the NVM management bytes. All data must...">NVM_MGMT_SIZE_B</a>),   \
                                   (offset-<a class="code" href="group__nvm.html#gac8953aab91c6b245cd9c0f03fe88d4bf" title="Define the number of bytes that comprise the NVM management bytes. All data must...">NVM_MGMT_SIZE_B</a>)/2);           \
    <span class="keywordflow">if</span>(status != ST_SUCCESS) { <span class="keywordflow">return</span> status; }                        \
    <span class="comment">/*Write the new data*/</span>                                                \
    status = <a class="code" href="group__flash.html#ga5eae5ae946c993e4f710e0e9b17f18a7" title="Writes a block of words to flash. A page is erased to 0xFFFF at every address. Only...">halInternalFlashWrite</a>(destPage+offset,                       \
                                   ram,                                   \
                                   (length)/2);                           \
    <span class="keywordflow">if</span>(status != ST_SUCCESS) { <span class="keywordflow">return</span> status; }                        \
    <span class="comment">/*Copy all data above the new data from the srcPage to the destPage*/</span> \
    status = <a class="code" href="group__flash.html#ga5eae5ae946c993e4f710e0e9b17f18a7" title="Writes a block of words to flash. A page is erased to 0xFFFF at every address. Only...">halInternalFlashWrite</a>(destPage+offset+length,                \
                                   (<a class="code" href="group__iar.html#ga409a5c4bea6981c30b308684efa33f6f">int16u</a> *)(srcPage+offset+length),     \
                                   (<a class="code" href="group__nvm.html#gaf82c3a8a7dccec38e893a2cf87cfcd72" title="Define the total size of a NVM page, in bytes. This must be a multiple of the memory...">NVM_DATA_SIZE_B</a>-                      \
                                    length-offset-                        \
                                    <a class="code" href="group__nvm.html#gac8953aab91c6b245cd9c0f03fe88d4bf" title="Define the number of bytes that comprise the NVM management bytes. All data must...">NVM_MGMT_SIZE_B</a>)/2);                  \
    <span class="keywordflow">if</span>(status != ST_SUCCESS) { <span class="keywordflow">return</span> status; }                        \
  } <span class="keywordflow">while</span>(0)
</pre></div>
<p>Definition at line <a class="el" href="nvm_8c_source.html#l00223">223</a> of file <a class="el" href="nvm_8c_source.html">nvm.c</a>.</p>

</div>
</div>
<a class="anchor" id="a310ac45c60bdd17bb8dbd7981512eda9"></a><!-- doxytag: member="nvm.c::WRITE_MGMT_16BITS" ref="a310ac45c60bdd17bb8dbd7981512eda9" args="(address, data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define WRITE_MGMT_16BITS</td>
          <td>(</td>
          <td class="paramtype">address, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">data&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Value:</b><div class="fragment"><pre class="fragment"><span class="keywordflow">do</span>{                                                     \
    <a class="code" href="group__iar.html#ga409a5c4bea6981c30b308684efa33f6f">int16u</a> value = data;                                  \
    status = <a class="code" href="group__flash.html#ga5eae5ae946c993e4f710e0e9b17f18a7" title="Writes a block of words to flash. A page is erased to 0xFFFF at every address. Only...">halInternalFlashWrite</a>((address), &amp;value, 1); \
    <span class="keywordflow">if</span>(status != ST_SUCCESS) {                         \
      <span class="keywordflow">return</span> status;                                      \
    }                                                     \
  } <span class="keywordflow">while</span>(0)
</pre></div>
<p>Definition at line <a class="el" href="nvm_8c_source.html#l00246">246</a> of file <a class="el" href="nvm_8c_source.html">nvm.c</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="af47df57a01ae5d80ddaff1b8b448215d"></a><!-- doxytag: member="nvm.c::VAR_AT_SEGMENT" ref="af47df57a01ae5d80ddaff1b8b448215d" args="(const int8u nvmStorageLeft[NVM_DATA_SIZE_B], __NVM__)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">NO_STRIPPING __no_init VAR_AT_SEGMENT </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="group__iar.html#gae712ac7a6479b38bdbb3286e80b72049">int8u</a>&nbsp;</td>
          <td class="paramname"> <em>nvmStorageLeft</em>[NVM_DATA_SIZE_B], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">__NVM__&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
</div>
<hr size="1">

<table border="0" cellspacing="0" cellpadding="0" width=100%>

<tr>

<td><address><small>

Hardware Abstraction Layer. <br>

1.0.1.

</small></address>

</td>

<td align="right">

<address><small>

Copyright &copy; 2009 by STMicrolectronics. All rights reserved.<br>

Generated Wed Sep 1 13:42:07 2010 with <a href="http://www.doxygen.org/index.html">Doxygen</a> 1.6.1.

</small></address>

</td>

</tr>

</table>

</body>

</html>
