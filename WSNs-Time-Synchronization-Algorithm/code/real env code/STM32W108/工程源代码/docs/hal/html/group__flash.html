<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">

<title>Hardware Abstraction Layer: Flash</title>

<LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">

</head><body>

<table border="0" cellspacing="0" cellpadding="0"  width=100%>

<tr>

<td><img src="ST_Logo.gif"></td>

<td> <div class="qindex">

<a class="qindex" href="index.html">Home</a>&nbsp;

 | &nbsp;<a class="qindex" href="modules.html">Modules</a>&nbsp;

 | &nbsp;<a class="qindex" href="annotated.html">Data Structures</a>&nbsp;

 | &nbsp;<a class="qindex" href="files.html">File List</a>&nbsp;

 | &nbsp;<a class="qindex" href="globals.html">Index</a></div>

</td>

</table>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>Flash</h1>
<p>Definition and description of public flash manipulation routines.  
<a href="#_details">More...</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__flash.html#ga0cd5188b52772a3fa41c54475539188a">MFB_MASS_ERASE</a>&nbsp;&nbsp;&nbsp;0x01</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Assign numerical value to the type of erasure requested.  <a href="#ga0cd5188b52772a3fa41c54475539188a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__flash.html#ga229ba2e0f5afcc6df7189e9d5405729c">MFB_PAGE_ERASE</a>&nbsp;&nbsp;&nbsp;0x02</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__flash.html#ga1c0b88a1e42d9dc33c1049743ab83720">CIB_ERASE</a>&nbsp;&nbsp;&nbsp;0x03</td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__iar.html#ga7670a4e8a07d9ebb00411948b0bbf86d">boolean</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__flash.html#ga04dc9eef74066ec15dcfbd603aaf4a52">halFlashEraseIsActive</a> (void)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Tells the calling code if a Flash Erase operation is active.  <a href="#ga04dc9eef74066ec15dcfbd603aaf4a52"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__micro.html#gafddf1f4a9c9eff790d56c8950c1fb0ad">StStatus</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__flash.html#ga4444bbd2d2343a108894d5e0412c7e5c">halInternalFlashErase</a> (<a class="el" href="group__iar.html#gae712ac7a6479b38bdbb3286e80b72049">int8u</a> eraseType, <a class="el" href="group__iar.html#ga2ba8e0357fdc7b7a450e6893ed81e8e3">int32u</a> address)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Erases a section of flash back to all 0xFFFF.  <a href="#ga4444bbd2d2343a108894d5e0412c7e5c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__micro.html#gafddf1f4a9c9eff790d56c8950c1fb0ad">StStatus</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__flash.html#ga5eae5ae946c993e4f710e0e9b17f18a7">halInternalFlashWrite</a> (<a class="el" href="group__iar.html#ga2ba8e0357fdc7b7a450e6893ed81e8e3">int32u</a> address, <a class="el" href="group__iar.html#ga409a5c4bea6981c30b308684efa33f6f">int16u</a> *data, <a class="el" href="group__iar.html#ga2ba8e0357fdc7b7a450e6893ed81e8e3">int32u</a> length)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Writes a block of words to flash. A page is erased to 0xFFFF at every address. Only two writes can be performed to the same address between erasures and this is enforced by the flash interface controller. If the value already in the address being written to is 0xFFFF, any value can be written. If the value is not 0xFFFF and not 0x0000, only 0x0000 can be written. If the value is 0x0000, nothing can be written.  <a href="#ga5eae5ae946c993e4f710e0e9b17f18a7"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__micro.html#gafddf1f4a9c9eff790d56c8950c1fb0ad">StStatus</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__flash.html#ga6f413da8a04e1c9ddd3b429268347506">halInternalCibOptionByteWrite</a> (<a class="el" href="group__iar.html#gae712ac7a6479b38bdbb3286e80b72049">int8u</a> byte, <a class="el" href="group__iar.html#gae712ac7a6479b38bdbb3286e80b72049">int8u</a> data)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Writes an option byte to the customer information block. Only two writes can be performed to the same address between erasures and this is enforced by the flash interface controller.  <a href="#ga6f413da8a04e1c9ddd3b429268347506"></a><br/></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>Definition and description of public flash manipulation routines. </p>
<dl class="note"><dt><b>Note:</b></dt><dd>During an erase or a write the flash is not available, which means code will not be executable from flash. These routines still execute from flash, though, since the bus architecture can support doing so. <b>Additonally, this also means all interrupts will be disabled.</b></dd></dl>
<p><b>Hardware documentation indicates 40us for a write and 21ms for an erase.</b></p>
<p>See <a class="el" href="flash_8h.html" title="Header for flash for APIs.">flash.h</a> for source code. </p>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="ga1c0b88a1e42d9dc33c1049743ab83720"></a><!-- doxytag: member="flash.h::CIB_ERASE" ref="ga1c0b88a1e42d9dc33c1049743ab83720" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CIB_ERASE&nbsp;&nbsp;&nbsp;0x03</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="flash_8h_source.html#l00047">47</a> of file <a class="el" href="flash_8h_source.html">flash.h</a>.</p>

</div>
</div>
<a class="anchor" id="ga0cd5188b52772a3fa41c54475539188a"></a><!-- doxytag: member="flash.h::MFB_MASS_ERASE" ref="ga0cd5188b52772a3fa41c54475539188a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MFB_MASS_ERASE&nbsp;&nbsp;&nbsp;0x01</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Assign numerical value to the type of erasure requested. </p>

<p>Definition at line <a class="el" href="flash_8h_source.html#l00045">45</a> of file <a class="el" href="flash_8h_source.html">flash.h</a>.</p>

</div>
</div>
<a class="anchor" id="ga229ba2e0f5afcc6df7189e9d5405729c"></a><!-- doxytag: member="flash.h::MFB_PAGE_ERASE" ref="ga229ba2e0f5afcc6df7189e9d5405729c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MFB_PAGE_ERASE&nbsp;&nbsp;&nbsp;0x02</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="flash_8h_source.html#l00046">46</a> of file <a class="el" href="flash_8h_source.html">flash.h</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="ga04dc9eef74066ec15dcfbd603aaf4a52"></a><!-- doxytag: member="flash.h::halFlashEraseIsActive" ref="ga04dc9eef74066ec15dcfbd603aaf4a52" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__iar.html#ga7670a4e8a07d9ebb00411948b0bbf86d">boolean</a> halFlashEraseIsActive </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Tells the calling code if a Flash Erase operation is active. </p>
<p>This state is import to know because Flash Erasing is ATOMIC for 21ms and could disrupt interrupt latency. But if an ISR can know that it wasn't serviced immediately due to Flash Erasing, then the ISR has the opportunity to correct in whatever manner it needs to.</p>
<dl class="return"><dt><b>Returns:</b></dt><dd>A boolean flag: TRUE if Flash Erase is active, FALSE otherwise. </dd></dl>

<p>Definition at line <a class="el" href="flash_8c_source.html#l00038">38</a> of file <a class="el" href="flash_8c_source.html">flash.c</a>.</p>

</div>
</div>
<a class="anchor" id="ga6f413da8a04e1c9ddd3b429268347506"></a><!-- doxytag: member="flash.h::halInternalCibOptionByteWrite" ref="ga6f413da8a04e1c9ddd3b429268347506" args="(int8u byte, int8u data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__micro.html#gafddf1f4a9c9eff790d56c8950c1fb0ad">StStatus</a> halInternalCibOptionByteWrite </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__iar.html#gae712ac7a6479b38bdbb3286e80b72049">int8u</a>&nbsp;</td>
          <td class="paramname"> <em>byte</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__iar.html#gae712ac7a6479b38bdbb3286e80b72049">int8u</a>&nbsp;</td>
          <td class="paramname"> <em>data</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Writes an option byte to the customer information block. Only two writes can be performed to the same address between erasures and this is enforced by the flash interface controller. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>byte</em>&nbsp;</td><td>The option byte number, 0 though 7, to be programmed.</td></tr>
    <tr><td valign="top"></td><td valign="top"><em>data</em>&nbsp;</td><td>The 8 bit value to be programmed into the option byte. The hardware is responsible for calculating the compliment and programming the full 16bit option byte space.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>An <a class="el" href="group__micro.html#gafddf1f4a9c9eff790d56c8950c1fb0ad">StStatus</a> value indicating the success or failure of the command:<ul>
<li>ST_ERR_FLASH_PROG_FAIL if the byte chosen is greater than 7, write protection is enabled, or the byte is being written to more than twice between erasures.</li>
<li>ST_ERR_FLASH_VERIFY_FAILED if write verification failed</li>
<li>ST_SUCCESS if writing completed and verified properly </li>
</ul>
</dd></dl>

<p>Definition at line <a class="el" href="flash_8c_source.html#l00352">352</a> of file <a class="el" href="flash_8c_source.html">flash.c</a>.</p>

</div>
</div>
<a class="anchor" id="ga4444bbd2d2343a108894d5e0412c7e5c"></a><!-- doxytag: member="flash.h::halInternalFlashErase" ref="ga4444bbd2d2343a108894d5e0412c7e5c" args="(int8u eraseType, int32u address)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__micro.html#gafddf1f4a9c9eff790d56c8950c1fb0ad">StStatus</a> halInternalFlashErase </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__iar.html#gae712ac7a6479b38bdbb3286e80b72049">int8u</a>&nbsp;</td>
          <td class="paramname"> <em>eraseType</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__iar.html#ga2ba8e0357fdc7b7a450e6893ed81e8e3">int32u</a>&nbsp;</td>
          <td class="paramname"> <em>address</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Erases a section of flash back to all 0xFFFF. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>eraseType</em>&nbsp;</td><td>Choose one of the three types of erasures to perform.</p>
<ul>
<li>MFB_MASS_ERASE (0x01) Erase the entire main flash block.</li>
<li>MFB_PAGE_ERASE (0x02) Erase one hardware page in the main flash block chosen by the <code>address</code> parameter.</li>
<li>CIB_ERASE (0x03) Erase the entire customer information block.</li>
</ul>
</td></tr>
    <tr><td valign="top"></td><td valign="top"><em>address</em>&nbsp;</td><td>This parameter is only effectual when a MFB_PAGE_ERASE is being performed. The hardware page encapsulating the address given in this parameter will be erased. A hardware page size depends on the chip</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>An <a class="el" href="group__micro.html#gafddf1f4a9c9eff790d56c8950c1fb0ad">StStatus</a> value indicating the success or failure of the command:<ul>
<li>ST_ERR_FATAL if the <code>eraseType</code> is not valid</li>
<li>ST_ERR_FLASH_ERASE_FAIL if erasing failed due to write protection</li>
<li>ST_ERR_FLASH_VERIFY_FAILED if erase verification failed</li>
<li>ST_SUCCESS if erasure completed and verified properly </li>
</ul>
</dd></dl>

<p>Definition at line <a class="el" href="flash_8c_source.html#l00228">228</a> of file <a class="el" href="flash_8c_source.html">flash.c</a>.</p>

</div>
</div>
<a class="anchor" id="ga5eae5ae946c993e4f710e0e9b17f18a7"></a><!-- doxytag: member="flash.h::halInternalFlashWrite" ref="ga5eae5ae946c993e4f710e0e9b17f18a7" args="(int32u address, int16u *data, int32u length)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__micro.html#gafddf1f4a9c9eff790d56c8950c1fb0ad">StStatus</a> halInternalFlashWrite </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__iar.html#ga2ba8e0357fdc7b7a450e6893ed81e8e3">int32u</a>&nbsp;</td>
          <td class="paramname"> <em>address</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__iar.html#ga409a5c4bea6981c30b308684efa33f6f">int16u</a> *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__iar.html#ga2ba8e0357fdc7b7a450e6893ed81e8e3">int32u</a>&nbsp;</td>
          <td class="paramname"> <em>length</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Writes a block of words to flash. A page is erased to 0xFFFF at every address. Only two writes can be performed to the same address between erasures and this is enforced by the flash interface controller. If the value already in the address being written to is 0xFFFF, any value can be written. If the value is not 0xFFFF and not 0x0000, only 0x0000 can be written. If the value is 0x0000, nothing can be written. </p>
<p><b>NOTE:</b> This function can NOT write the option bytes and will throw an error if that is attempted.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>address</em>&nbsp;</td><td>The starting address of where the programming will occur. This parameter MUST be half-word aligned since all programming operations are half-words. Also, the address parameter is NOT a pointer. This routines will cast the address to a pointer for the actual hardware access.</td></tr>
    <tr><td valign="top"></td><td valign="top"><em>data</em>&nbsp;</td><td>A pointer to a buffer containing the 16bit (half-words) to be written.</td></tr>
    <tr><td valign="top"></td><td valign="top"><em>length</em>&nbsp;</td><td>The number of 16bit (half-words) contained in the data buffer to be written to flash.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>An <a class="el" href="group__micro.html#gafddf1f4a9c9eff790d56c8950c1fb0ad">StStatus</a> value indicating the success or failure of the command:<ul>
<li>ST_ERR_FLASH_PROG_FAIL if the address is not half-word aligned, the address is inside the option bytes, write protection is enabled, or the address is being written to more than twice between erasures.</li>
<li>ST_ERR_FLASH_VERIFY_FAILED if write verification failed</li>
<li>ST_SUCCESS if writing completed and verified properly </li>
</ul>
</dd></dl>

<p>Definition at line <a class="el" href="flash_8c_source.html#l00291">291</a> of file <a class="el" href="flash_8c_source.html">flash.c</a>.</p>

</div>
</div>
</div>
<hr size="1">

<table border="0" cellspacing="0" cellpadding="0" width=100%>

<tr>

<td><address><small>

Hardware Abstraction Layer. <br>

1.0.1.

</small></address>

</td>

<td align="right">

<address><small>

Copyright &copy; 2009 by STMicrolectronics. All rights reserved.<br>

Generated Wed Sep 1 13:42:43 2010 with <a href="http://www.doxygen.org/index.html">Doxygen</a> 1.6.1.

</small></address>

</td>

</tr>

</table>

</body>

</html>
